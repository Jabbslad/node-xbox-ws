
var redis = require('redis')
  , util = require('util')
  , client = redis.createClient();

module.exports = {
	all: function(callback) {
		client.keys("*", function(err, keys) {
			var friends = {};
			var multi = client.multi();
			keys.forEach(function(reply, i) {
				var key = reply.slice(8);
				friends[key] = {};
				multi.hget(reply, "gamerpic", function(err, res) {
					friends[key].gamerpic = res;
				});
				multi.hget(reply, "online", function(err, res) {
					friends[key].online = res;
				});
				multi.hget(reply, "status", function(err, res) {
					friends[key].status = res;
				});
				multi.hget(reply, "gamerscore", function(err, res) {
					friends[key].gamerscore = res;
				});
			});
			multi.exec(function(err, replies) {
				callback(friends);
			});
		});	
	},
	get: function(key, callback) {
		client.hgetall('friends:' + key, function(err, res) {
			callback(res);
		})
	}
}	