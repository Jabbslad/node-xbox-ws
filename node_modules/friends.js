
var redis = require('redis')
  , util = require('util')
  , client = redis.createClient();

module.exports = {
	all: function(callback) {
		client.keys("*", function(err, keys) {
			var friends = {};
			var multi = client.multi();
			keys.forEach(function(reply, i) {
				var key = reply.slice(8);
				friends[key] = {};
				multi.hget(reply, "gamerpic", function(err, res) {
					friends[key].gamerpic = res;
				});
				multi.hget(reply, "name", function(err, res) {
					friends[key].name = res;
				});
				multi.hget(reply, "location", function(err, res) {
					friends[key].location = res;
				});
				multi.hget(reply, "rep", function(err, res) {
					friends[key].rep = res;
				});
				multi.hget(reply, "bio", function(err, res) {
					friends[key].bio = res;
				});
				multi.hget(reply, "motto", function(err, res) {
					friends[key].motto = res;
				});
				multi.hget(reply, "online", function(err, res) {
					friends[key].online = res;
				});
				multi.hget(reply, "status", function(err, res) {
					friends[key].status = res;
				});
				multi.hget(reply, "gamerscore", function(err, res) {
					friends[key].gamerscore = res;
				});
			});
			multi.exec(function(err, replies) {
				callback(friends);
			});
		});	
	},
	get: function(key, callback) {
		client.hgetall('friends:' + key, function(err, res) {
			callback(res);
		})
	},
	getByPresence: function(status, callback) {
		module.exports.all(function(friends) {
			var statusFriends = {};
			for (var key in friends) {
				if(status == friends[key].online) {
					statusFriends[key] = friends[key];	
				}		
			}
			callback(statusFriends);
		});		
	}
}	